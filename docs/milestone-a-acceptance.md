# Milestone A 验收（主题 Token + 导出一致性）

目标：按 ROADMAP 的 Milestone A **验收标准**完成验收闭环。

- 验收标准 1：切换主题时，已有组件“整体风格一致变化”。
- 验收标准 2：同一模板在预览与导出差异显著减少（差异点有记录与规避方案）。

> 说明：本项目的“预览”与“导出 HTML”已共用同一份 `exportCss`（导出 CSS），因此差异主要来自公众号自身的富文本清洗与渲染限制。本验收将把这些差异**显式记录**并给出规避策略。

---

## 1. 验收环境

- 使用桌面端应用（Electron）。
- 公众号后台（PC 端）用于粘贴验证。
- 建议至少选 3 个主题对比：`clean`、`warm`、`ink`（或你常用的 3 个）。

---

## 2. 验收用例（10 个典型模板页面）

优先使用版式预设（Layout Presets）作为“整页模板”：

1) `layoutStory`（长文结构）
2) `layoutHowTo`（教程结构）
3) `layoutList`（清单结构）
4) `layoutNews`（快讯结构）
5) `layoutProduct`（产品介绍）
6) `layoutReview`（测评结构）
7) `layoutInterview`（访谈结构）
8) `layoutWeekly`（周报结构）
9) `layoutKnowledge`（知识笔记结构）

第 10 个用例建议做“组件拼盘页”（覆盖更多组件）：
10) 组件拼盘：依次插入 `callout`、`card`、`titlebar`、`quote`、`dividerFancy`、`steps`、`checklist`、`imageCaption` 等组件/模板片段，形成一页综合对比。

---

## 3. 验收标准 1：主题切换一致性

对每个用例（至少抽查 3 个整页 + 组件拼盘页），按下面步骤：

1) 应用模板/版式预设。
2) 依次切换主题（至少 3 个）。
3) 观察并记录：
   - 主色（强调色）是否全局一致变化（链接、标题装饰、引用/卡片的强调边等）。
   - 背景、描边、阴影、圆角等是否在组件之间呈现一致的风格（不是某个组件“跳出主题”）。
   - 文本/弱化文本颜色是否随主题整体协调。

记录方式：在 [milestone-a-diff-log.md](milestone-a-diff-log.md) 的「主题一致性」段落填表。

验收通过判定（建议）：
- 主题切换时，页面整体的“主色/弱化色/背景/描边风格”对所有组件是可感知且一致的；
- 未出现某个组件明显“写死颜色”导致与主题冲突。

---

## 4. 验收标准 2：预览 vs 导出差异显著减少

对每个用例（建议全 10 个），按下面步骤：

1) 预览区确认效果。
2) 执行一次“导出完整 HTML”（或“复制完整 HTML”），粘贴到公众号后台。
3) 对照检查项（建议截图）：
   - 标题层级：字号、间距、装饰条位置
   - 段落：行距、段距、首行缩进、对齐
   - 引用/卡片：边框、背景、圆角、内边距
   - 列表：缩进、行距
   - 图片：是否压住文字、是否居中、图注是否正常

记录方式：在 [milestone-a-diff-log.md](milestone-a-diff-log.md) 的「预览 vs 公众号差异」段落填表。

验收通过判定（建议）：
- 主要视觉结构一致（布局不崩、间距基本一致、组件样式不丢失）；
- 若存在差异，必须能在差异记录中解释清楚，并给出规避方案（见下一节）。

---

## 5. 已知差异与规避方案（作为验收“可解释性”基线）

公众号常见限制（会导致预览与公众号差异）：
- 公众号会清洗/重排部分 HTML/CSS，尤其是复杂选择器、部分高级 CSS（例如新特性函数）。
- 公众号可能对 `margin`、`line-height`、图片布局进行二次处理。
- 粘贴链路可能丢失 `<style>` 的部分效果（与浏览器/公众号版本相关）。

建议规避策略（项目内已支持/建议使用）：
- 行高使用无单位倍数（例如 1.6/1.8），减少缩放导致的重叠风险。
- 图片使用块级布局（`display: block`）并避免复杂浮动。
- 如果需要“公众号后台可调段距”，复制时让段落 `margin: 0`（由公众号控制段距）；如果需要“锁定段距”，导出时用固定段距策略。
- 避免依赖 `position: sticky/absolute` 等定位型视觉；尽量用纯块级结构 + 背景/边框/圆角实现装饰。

---

## 6. 验收结论

当 [milestone-a-diff-log.md](milestone-a-diff-log.md) 完成以下两项，即认为 Milestone A 验收闭环完成：

- 「主题一致性」：至少 3 个整页 + 组件拼盘页通过。
- 「预览 vs 公众号差异」：10 个用例均有记录；差异项均给出规避方案或接受理由。
