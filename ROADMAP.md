# 后续方案 / Roadmap（微信排版助手 / WeChat Editor）

本文档用于规划项目后续迭代方向、里程碑与交付物，目标是把当前“可用的排版工具”推进到“像 96 编辑器那样精美、可扩展、可持续迭代的组件化排版系统”。

> 说明：本文以当前工程结构为基准（Electron + Vite + React + TipTap，已具备组件库、模板与主题目录），在此基础上增强“组件体系、主题体系、导出一致性、交互编辑能力、资产与生态”。

---

## 0. 当前基线（你已经拥有的能力）

- 桌面端能力：Electron 打包、GitHub Releases 发布、自动更新入口（检查/下载/安装）。
- 编辑器内核：TipTap（ProseMirror）+ 自定义扩展（带 class 的 heading/list 等）。
- 组件体系雏形：`src/wechat/library/components` 下已有多种精美组件；`templates` 与 `layoutPresets` 等。
- 主题体系雏形：`src/wechat/themes` 已有内置主题与注册表。
- UI 基础：编辑区 + 预览区、顶栏菜单、素材/组件插入。

接下来重点是把“组件”升级为“可配置、可复用、可维护的组件系统”。

---

## 0.1 已落地进展（2026-01-28）

- 主题 token 体系 v1（起步）：在导出 CSS 中新增 `--wce-*` token 别名，后续组件可逐步从 `--wechat-*` 迁移到 `--wce-*`。
- 组件属性面板 MVP：素材库新增「属性」页签，点选正文中的组件块即可在侧栏调整参数并应用。
- 组件可编辑实例（升级为可持续扩展的形态）：
  - 组件实例统一写入 `data-wce-component` + `data-wce-props`，支持再次选中继续编辑。
  - 组件元数据标准（Component Spec）已在类型与编辑器逻辑中兼容：`propSchema/defaultProps/schemaVersion/tags` 等（保留旧 `config/render` 以向后兼容）。
  - 属性面板增强：支持「重置为默认」「复制样式到同类组件」（只复制样式字段，避免覆盖标题/正文等内容字段）。
  - Markdown 源码模式：支持基于光标定位组件块并编辑参数；容器类组件应用属性时尽量保留内部正文内容。

已覆盖的可编辑组件（示例，后续可继续扩充）：
- `calloutInfo`（提示框）
- `card`（内容卡片）
- `titlebarH2`（标题条 H2）
- `royalFrameScroll`（紫金边框 + 内嵌滚动区，保留正文策略）
- `badgeH3` / `checklist` / `steps` / `dividerLine` / `dividerFancy` / `quoteFocus` / `guide` / `imageCaption` 等（组件实例携带可编辑 props）

---

## 1. 总目标（对标 96 编辑器的核心指标）

### 1.1 体验目标
- 所见即所得：编辑器内效果 ≈ 复制到公众号后的效果（差异可控、可解释）。
- 精美组件：不仅“好看”，还要“可配置”（颜色、风格、密度、对齐、装饰等）。
- 低门槛：模板一键套用、主题一键换色、组件一键插入。

### 1.2 工程目标
- 主题 token 化：组件样式不写死颜色/圆角/阴影等，全部走 token。
- 导出一致性：同源 CSS，分层打包（编辑器预览/公众号导出）。
- 组件可扩展：组件有清晰接口、Schema、属性面板定义、迁移策略。

---

## 2. 里程碑规划（推荐按阶段推进）

> 时间仅做参考，你可以按精力与优先级调整。

### Milestone A（1~2 周）：打牢“主题 + 导出一致性”地基
**目标**：先解决“看起来高级但可控”的核心——token 体系与导出一致性。

交付物：
- 主题 token 体系 v1
  - 统一定义：颜色、文字、间距、圆角、阴影、描边、分割线、字体层级。
  - 输出到 CSS 变量：例如 `--wce-primary`、`--wce-radius-md`、`--wce-shadow-1`。
- CSS 分层策略
  - `editor.css`：编辑器内（含选中态、hover、交互辅助线）。
  - `export.css`：导出到公众号（尽量纯静态、避免依赖外部资源）。
  - 两者共享一套 token + 基础组件样式源文件（构建时按 target 输出）。
- 导出验证清单
  - 定义 10 个典型模板页面，复制到公众号后逐项截图对比并记录差异（建立回归基准）。

验收标准：
- 切换主题时，已有组件“整体风格一致变化”。
- 同一模板在预览与导出差异显著减少（差异点有记录与规避方案）。

---

### Milestone B（2~4 周）：组件“可配置化”与属性面板（关键）
**目标**：让组件从“插入后就定型”升级到“插入后可编辑参数”，这是对标精美编辑器的分水岭。

交付物：
- 组件元数据标准（Component Spec）
  - `id / name / description / tags / previewThumb`
  - `schemaVersion`
  - `defaultProps`（组件默认参数）
  - `propSchema`（参数定义：类型、枚举、范围、默认值、依赖关系）
  - `renderer`（渲染函数：根据 props 输出 HTML/节点）
- 属性面板 UI
  - 选中某个组件块时，右侧出现“属性面板”，可以修改：
    - 颜色/强调色
    - 风格（outline/filled/soft）
    - 密度（padding/spacing）
    - 对齐/布局（居中、左右）
    - 装饰（icon、角标、分割线样式）
  - 支持“重置为默认”“复制样式到同类组件”。
- 组件存储策略（在 TipTap/ProseMirror 中保存 props）
  - 建议：组件块节点存 `data-*` 或 node attrs，导出时转为 `data-wce-*`。

推荐优先落地的 6 个“高感知组件”：
- Callout / 提示框（信息、警告、成功、重点）
- Card / 卡片（标题区、内容区、尾注区、带图）
- Titlebar / 标题条（多风格标题）
- Steps / 步骤条（数字/圆点/线条）
- QuoteFocus / 聚焦引用（强视觉）
- DividerFancy / 花式分割线（装饰能力）

验收标准：
- 至少 3 个组件支持属性面板修改并应用（可后续演进为“边改边生效”），且导出后保留同样外观。

---

### Milestone C（4~6 周）：模板系统升级（从“模板”到“模板 + 主题 + 组件组合”）
**目标**：把模板做成“可组合、可复用”的资产系统，用户体验上对标“主题市场/模板库”。

交付物：
- 模板结构规范
  - 模板描述：标题、封面、适用场景、包含组件、推荐主题。
  - 模板一键应用：可选择“替换全文 / 插入当前位置 / 作为新文档”。
- 版式预设（Layout Presets）增强
  - 提供“窄版/标准/宽版/留白大/信息密度高”等。
- 内置模板库扩充
  - 至少 20 套：公告、教程、复盘、产品介绍、活动推文、招聘、读书笔记等。

验收标准：
- 模板库可筛选（场景/风格/组件/主题），点击即可预览与应用。

---

### Milestone D（6~10 周）：编辑体验高级化（交互与效率）
**目标**：让它更像“专业编辑器”：效率、可控性、细节。

交付物：
- 块级编辑能力增强
  - 组件块快捷工具条（复制/删除/上移下移/转换风格）。
  - 组件块拖拽排序（drag handle）。
  - 快捷插入（`/` 命令面板：输入 `/callout` `/card`）。
- 历史/撤销增强
  - 关键操作合并（例如连续改 props 只记一次 undo）。
- 选区与样式一致性
  - 标题层级、段落间距、列表缩进统一标准。

验收标准：
- 用户不用鼠标也能完成大部分插入与调整（快捷键 + / 命令）。

---

### Milestone E（长期）：生态化与商业化能力（可选）
**目标**：像成熟编辑器一样“可扩展/可运营”。

可选交付物：
- 主题/模板导入导出（JSON 包 + 资源文件）
- 插件机制（第三方组件包）
- 组件市场/主题市场（本地目录扫描即可起步）
- 数据与反馈（匿名、可关闭）：使用频率、常见失败点

---

## 3. 技术方案要点（如何实现“精美组件系统”）

### 3.1 主题 Token（Design Tokens）建议
- 建立 `tokens.ts`（或 `themeTokens.ts`）统一声明 token 名称与默认值。
- 每个主题只提供 token 值映射，不直接定义组件 CSS。
- 组件 CSS 只引用 token，例如：
  - 背景：`var(--wce-surface)`
  - 强调：`var(--wce-primary)`
  - 圆角：`var(--wce-radius-lg)`
  - 阴影：`var(--wce-shadow-2)`

### 3.2 组件 Props 与 Schema 版本
- 每个组件维护 `schemaVersion`，未来升级可迁移旧数据。
- Props 推荐支持：
  - `variant`（soft/filled/outline）
  - `tone`（info/success/warn/danger/neutral）
  - `density`（compact/normal/comfortable）
  - `align`（left/center/right）
  - `decoration`（icon、corner、divider 等）

### 3.3 编辑器内渲染 vs 导出渲染
- 编辑器内：允许交互辅助（选中边框、拖拽把手、hover）。
- 导出：必须“纯静态、最少依赖”，避免复杂定位导致公众号变形。
- 尽量走同一份 HTML 结构与 class，只在 CSS 层做差异。

### 3.4 资产管理（SVG/图片/装饰）
- 建议采用内置 SVG（可 `currentColor`），随主题自动变色。
- 复杂装饰尽量用 CSS（渐变、mask、border-image），减少外链图片。

---

## 4. 质量与发布策略（确保可持续迭代）

### 4.1 回归样例库
- 建立“模板回归集”：每次改 CSS/组件都用同一批模板验证。
- 每个里程碑结束时，输出截图对比（预览 vs 公众号）。

### 4.2 版本与兼容
- 组件 schemaVersion 变化必须写入 changelog，并提供迁移逻辑。
- 导出格式变动要标注“可能影响旧文章”。

### 4.3 自动更新（你已具备）
- Release 必须包含：安装包 + `latest.yml` + `*.blockmap`。
- Release 摘要自动从 changelog 提取（已在 CI 中实现）。

---

## 5. 推荐的下一步（本周就能开干的 3 件事）

1) 主题 token v1：先让“所有组件风格统一可控”。
2) 组件属性面板 MVP：先挑 3 个组件支持参数修改并能导出保持一致。
3) 模板回归集：建立 10 个模板的对比清单，作为后续迭代护城河。

---

## 6. 我可以直接帮你落地的内容（你确认后我就开工）

你选一个起步方向，我可以直接在代码里实现并跑通：
- A：主题 token v1 + 把现有 3~5 个组件改成 token 驱动。
- B：组件属性面板 MVP（选中组件 → 左侧面板修改 props → 预览/导出一致）。
- C：`/` 命令面板 + 组件插入体验升级。

建议先做 B（感知最大），同时并行 A（让“精美感”更统一）。
